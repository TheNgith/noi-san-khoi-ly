.pages_container {
    position: relative;
    width: 100%;
    margin-top: 40px;
    top: 60px;
    justify-items: center;
    /* Zoom control - set via JavaScript */
    --zoom-level: 1;
    --base-page-width: 45vw;
}

/* The main container for a chapter */
.comment-block {
    position: relative;
}

/* Column of pages (images stacked vertically) */
.pages-column {
    position: relative;
    transition: opacity 150ms ease;
}

/* Transition state for layout changes */
.pages-column.layout-transitioning {
    opacity: 0;
}

/* Wrapper for each page + its comment panel */
.page-wrapper {
    display: flex;
    position: relative;
    margin-bottom: var(--gap-between-pages);
    justify-content: center;
}

/* Container for page image + overlay */
.page-container {
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    /* Apply zoom level to page width */
    width: calc(var(--base-page-width) * var(--zoom-level));
    max-width: calc(100vw - 300px); /* Leave room for panel */
    transition: transform 380ms cubic-bezier(.2, .8, .2, 1),
                width 280ms cubic-bezier(.2, .8, .2, 1);
    /* Offset right to center the page visually (half of panel + gap) */
    transform: translateX(calc((260px + 10px) / 2));
}

/* Shift page left when comment is open */
.page-wrapper.has-open-comment .page-container {
    transform: translateX(0);
}

/* Your page images */
.page-container .page {
    display: block;
    width: 100%;
    height: auto;
}

/* Transparent overlay covering only the page image */
.comment-overlay {
    position: absolute;
    inset: 0;
    background: transparent;
    cursor: crosshair;
    z-index: 2;
}

/* When comment mode is off, disable clicks */
.comment-overlay.off {
    pointer-events: none;
    cursor: default;
}

/* Comment panel next to each page */
.comment-panel {
    position: relative;
    width: 260px;
    flex-shrink: 0;
    margin-left: 10px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    color: #eee;
    /* Shift together with page-container to keep them aligned */
    transform: translateX(calc((260px + 10px) / 2));
    transition: transform 380ms cubic-bezier(.2, .8, .2, 1);
}

/* Shift panel back when comment is open */
.page-wrapper.has-open-comment .comment-panel {
    transform: translateX(0);
}

/* =========================
   Dual Page Mode
   ========================= */

/* Container for a pair of pages in dual-page mode */
.page-pair {
    display: flex;
    gap: 1px;
    margin-bottom: var(--gap-between-pages);
    /* Apply zoom to the pair - base is ~90vw for two pages */
    width: calc(90vw * var(--zoom-level));
    max-width: 100%;
    margin-left: auto;
    margin-right: auto;
    transition: width 280ms cubic-bezier(.2, .8, .2, 1);
}

/* In dual-page mode, use flex layout for side-by-side pages */
.page-pair .page-wrapper {
    display: flex;
    margin-bottom: 0;
    flex: 1;
    gap: 10px;
    justify-content: flex-start;
}

/* In dual-page mode, no centering transforms needed */
.page-pair .page-container {
    flex: 1;
    transform: none;
    /* Override single-page width, use flex for sizing */
    width: auto;
    max-width: none;
}

.page-pair .page-wrapper.has-open-comment .page-container {
    transform: none;
}

/* In dual-page mode, panels don't need centering transform */
.page-pair .comment-panel {
    width: 260px;
    flex-shrink: 0;
    margin-left: 0;
    transform: none;
}

.page-pair .page-wrapper.has-open-comment .comment-panel {
    transform: none;
}

/* Left page: reverse the flex direction so panel is on the left */
.page-pair .page-wrapper.left-page {
    flex-direction: row-reverse;
}

/* Right page: normal direction (panel on right) */
.page-pair .page-wrapper.right-page {
    flex-direction: row;
}

/* Hide comment bubbles in dual-page mode at high zoom (>=140% actual) */
.zoom-hide-bubbles .page-pair .comment-panel {
    visibility: hidden;
    opacity: 0;
    transition: opacity 200ms ease, visibility 0s 200ms;
}

.zoom-hide-bubbles .page-pair .comment-bubble {
    display: none;
}

/* Existing toggle button styles still fine */
.toggle-btn {
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    border: none;
    background: #333;
    color: #fff;
    cursor: pointer;
}
.toggle-btn.on {
    background: #007bff;
}